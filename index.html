<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard ‚Äî TradingHub</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .hero-card { background: linear-gradient(135deg, var(--card) 0%, #131d36 100%); border: 1px solid var(--border); border-radius: 16px; padding: 24px; margin-bottom: 20px; }
        .hero-value { font-size: 2.2rem; font-weight: 900; margin: 4px 0; }
        .hero-label { font-size: 0.75rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.5px; }
        .pnl-row { display: flex; gap: 12px; margin-top: 16px; }
        .pnl-chip { flex: 1; background: var(--bg2); border: 1px solid var(--border); border-radius: 10px; padding: 10px 12px; text-align: center; }
        .pnl-chip .label { font-size: 0.65rem; color: var(--text-dim); margin-bottom: 2px; }
        .pnl-chip .val { font-size: 0.95rem; font-weight: 700; }

        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 20px; }
        .stat-box { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 14px; text-align: center; }
        .stat-box .stat-num { font-size: 1.3rem; font-weight: 800; }
        .stat-box .stat-lbl { font-size: 0.68rem; color: var(--text-dim); margin-top: 2px; }

        .mini-pos { display: flex; align-items: center; justify-content: space-between; background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 12px 14px; }
        .mini-pos + .mini-pos { margin-top: 8px; }
        .mini-pos .pair { font-weight: 700; font-size: 0.9rem; }
        .mini-pos .meta { font-size: 0.7rem; color: var(--text-dim); }

        .mini-cal { display: grid; grid-template-columns: repeat(7, 1fr); gap: 3px; margin-bottom: 20px; }
        .mini-cal .day-header { font-size: 0.55rem; color: var(--text-dim); text-align: center; padding: 2px; }
        .mini-cal .day-cell { aspect-ratio: 1; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 0.6rem; font-weight: 600; color: var(--text-dim); background: var(--bg2); }
        .mini-cal .day-cell.win { background: var(--green-bg); color: var(--green); border: 1px solid rgba(0,230,138,0.2); }
        .mini-cal .day-cell.loss { background: var(--red-bg); color: var(--red); border: 1px solid rgba(255,77,106,0.2); }
        .mini-cal .day-cell.empty { background: transparent; }

        .activity-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid var(--border); }
        .activity-item:last-child { border-bottom: none; }
        .activity-date { font-size: 0.8rem; color: var(--text-dim); }
        .activity-val { font-size: 0.9rem; font-weight: 700; }

        .section-link { display: inline-block; font-size: 0.75rem; color: var(--blue); text-decoration: none; margin-top: 8px; }
    </style>
</head>
<body>
    <div class="bg-grid"></div>
    <div class="bg-glow"></div>

    <div class="container page-content">
        <div class="page-header">
            <h1>üè† Dashboard</h1>
            <p>Portfolio overview</p>
        </div>

        <!-- Portfolio Hero -->
        <div class="hero-card anim-fade anim-delay-1">
            <div class="hero-label">Portfolio Value</div>
            <div class="hero-value" id="portfolioVal">‚Äî</div>
            <div id="todayPnl" style="font-size:0.95rem;font-weight:700;"></div>
            <div class="pnl-row">
                <div class="pnl-chip"><div class="label">7D PnL</div><div class="val" id="pnl7d">‚Äî</div></div>
                <div class="pnl-chip"><div class="label">30D PnL</div><div class="val" id="pnl30d">‚Äî</div></div>
                <div class="pnl-chip"><div class="label">All Time</div><div class="val" id="pnlAll">‚Äî</div></div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="stats-grid anim-fade anim-delay-2" id="statsGrid"></div>

        <!-- Open Positions -->
        <div class="anim-fade anim-delay-2">
            <div class="section-title">üìä Open Positions <span class="live-dot"></span></div>
            <div class="section-divider"></div>
            <div id="openPos" style="margin-bottom:8px;"></div>
            <a href="positions.html" class="section-link">View all positions ‚Üí</a>
            <div style="margin-bottom:20px;"></div>
        </div>

        <!-- Mini Calendar -->
        <div class="anim-fade anim-delay-3">
            <div class="section-title">üìÖ February 2026</div>
            <div class="section-divider"></div>
            <div class="mini-cal" id="miniCal"></div>
            <a href="calendar.html" class="section-link">Full calendar ‚Üí</a>
            <div style="margin-bottom:20px;"></div>
        </div>

        <!-- Recent Activity -->
        <div class="anim-fade anim-delay-3">
            <div class="section-title">üïê Recent Activity</div>
            <div class="section-divider"></div>
            <div id="recentActivity" style="margin-bottom:20px;"></div>
        </div>

        <div class="footer">TradingHub &copy; 2026</div>
    </div>

    <script src="data.js"></script>
    <script src="nav.js"></script>
    <script>
        renderNav('dashboard');
        initParticles();

        const allDays = getAllDaysSorted();
        const totalPnl = allDays.reduce((s, d) => s + d.val, 0);
        const portfolioValue = INITIAL_ASSETS + totalPnl + OPEN_POSITIONS.reduce((s,p) => s+p.unrealizedPnl, 0);

        // Portfolio hero
        document.getElementById('portfolioVal').textContent = '$' + portfolioValue.toFixed(2);
        document.getElementById('portfolioVal').style.color = portfolioValue >= INITIAL_ASSETS ? 'var(--green)' : 'var(--red)';

        const today = allDays[allDays.length - 1];
        const todayEl = document.getElementById('todayPnl');
        todayEl.textContent = 'Today: ' + formatPnl(today.val);
        todayEl.style.color = pnlColor(today.val);

        // Period PnLs
        function periodPnl(days) {
            const slice = allDays.slice(-days);
            return slice.reduce((s, d) => s + d.val, 0);
        }
        function setChip(id, val) {
            const el = document.getElementById(id);
            el.textContent = formatPnl(val);
            el.style.color = pnlColor(val);
        }
        setChip('pnl7d', periodPnl(7));
        setChip('pnl30d', periodPnl(30));
        setChip('pnlAll', totalPnl);

        // Stats
        const wins = allDays.filter(d => d.val >= 0).length;
        const winRate = ((wins / allDays.length) * 100).toFixed(0);
        const streaks = calcStreaks(allDays);
        const streakText = streaks.current >= 0 ? streaks.current + 'W' : Math.abs(streaks.current) + 'L';
        const streakColor = streaks.current >= 0 ? 'var(--green)' : 'var(--red)';

        document.getElementById('statsGrid').innerHTML = `
            <div class="stat-box"><div class="stat-num" style="color:${parseInt(winRate)>=50?'var(--green)':'var(--red)'}">${winRate}%</div><div class="stat-lbl">Win Rate</div></div>
            <div class="stat-box"><div class="stat-num" style="color:${streakColor}">${streakText}</div><div class="stat-lbl">Current Streak</div></div>
            <div class="stat-box"><div class="stat-num">${allDays.length}</div><div class="stat-lbl">Total Trades</div></div>
            <div class="stat-box"><div class="stat-num" style="color:${pnlColor(totalPnl)}">${formatPnl(totalPnl)}</div><div class="stat-lbl">Net PnL</div></div>
        `;

        // Open positions mini cards
        document.getElementById('openPos').innerHTML = OPEN_POSITIONS.map(p => {
            const isProfit = p.unrealizedPnl >= 0;
            return `<div class="mini-pos">
                <div>
                    <div class="pair">${p.pair} <span class="badge badge-${p.direction.toLowerCase()}" style="font-size:0.65rem;padding:2px 6px;">${p.direction} ${p.leverage}</span></div>
                    <div class="meta">Entry $${p.entry} ‚Üí Mark $${p.markPrice}</div>
                </div>
                <div style="text-align:right">
                    <div style="font-weight:800;color:${pnlColor(p.unrealizedPnl)}">${formatPnl(p.unrealizedPnl)}</div>
                    <div style="font-size:0.75rem;color:${pnlColor(p.roi)}">${isProfit?'+':''}${p.roi}% ROI</div>
                </div>
            </div>`;
        }).join('');

        // Mini calendar for current month (Feb 2026)
        const febData = DAILY_PNL["2026-02"] || {};
        const firstDay = new Date(2026, 1, 1).getDay(); // 0=Sun
        const daysInMonth = 28;
        const headers = ['Su','Mo','Tu','We','Th','Fr','Sa'];
        let calHTML = headers.map(h => `<div class="day-header">${h}</div>`).join('');
        for (let i = 0; i < firstDay; i++) calHTML += '<div class="day-cell empty"></div>';
        for (let d = 1; d <= daysInMonth; d++) {
            const pnl = febData[d];
            const cls = pnl !== undefined ? (pnl >= 0 ? 'win' : 'loss') : '';
            calHTML += `<div class="day-cell ${cls}">${d}</div>`;
        }
        document.getElementById('miniCal').innerHTML = calHTML;

        // Recent activity
        const recent = allDays.slice(-5).reverse();
        document.getElementById('recentActivity').innerHTML = recent.map(d => {
            const dateStr = `${d.day}/${d.month.split('-')[1]}/${d.month.split('-')[0]}`;
            return `<div class="activity-item">
                <div class="activity-date">${d.val >= 0 ? 'üü¢' : 'üî¥'} ${dateStr}</div>
                <div class="activity-val" style="color:${pnlColor(d.val)}">${formatPnl(d.val)}</div>
            </div>`;
        }).join('');
    </script>
</body>
</html>
